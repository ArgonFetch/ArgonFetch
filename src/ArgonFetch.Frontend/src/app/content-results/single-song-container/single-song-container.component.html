<div class="song-container">
  <div class="song-content">
    <div class="song-thumbnail">
      <img [src]="resourceInformation.mediaItems?.[0]?.coverUrl" alt="Song Cover">
    </div>

    <div class="song-info">
      <h3 class="song-title" [title]="resourceInformation.mediaItems?.[0]?.title || ''">{{ resourceInformation.mediaItems?.[0]?.title }}</h3>
      <p class="song-artist">{{ resourceInformation.mediaItems?.[0]?.author }}</p>

      <!-- Download Progress Bar -->
      <div class="download-progress-container" *ngIf="isDownloading">
        <div class="download-info">
          <span></span>
          <div class="download-stats">
            <span class="download-speed" *ngIf="downloadSpeed">{{ downloadSpeed }}</span>
            <span class="download-size" *ngIf="downloadedMB">
              {{ downloadedMB }} MB
              <span *ngIf="totalMB"> / {{ totalMB }} MB</span>
            </span>
            <span class="download-percentage">{{ downloadProgress }}%</span>
          </div>
        </div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar" [style.width.%]="downloadProgress" [style.max-width]="'100%'"></div>
        </div>
      </div>
    </div>

    <!-- Download Button with Dropdown Menu -->
    <div class="download-button-container">
      <button class="action-button download-button"
              [disabled]="isDownloading"
              (click)="toggleMainMenu($event)">
        <fa-icon *ngIf="!isDownloading" [icon]="faDownload"></fa-icon>
        <fa-icon *ngIf="isDownloading" [icon]="faSpinner" class="fa-spin"></fa-icon>
      </button>

      <!-- Main Dropdown Menu -->
      <div class="dropdown-menu main-menu" *ngIf="showMainMenu && !isDownloading">
        <!-- Video + Audio Option (if video content is available) -->
        <div class="menu-item-wrapper"
             *ngIf="hasCombinedUrls()"
             (mouseenter)="showVideoMenu($event)"
             (mouseleave)="showVideoSubmenu = false">
          <div class="menu-item">
            <span>Video</span>
            <fa-icon [icon]="faChevronRight" class="submenu-arrow"></fa-icon>
          </div>

          <!-- Video Quality Submenu -->
          <div class="dropdown-menu submenu" *ngIf="showVideoSubmenu">
            <div class="menu-item" *ngIf="hasVideoQuality(Quality.Best)" (click)="onDownload(Quality.Best, 'combined', $event)">Best ({{ getVideoQuality(Quality.Best) }})</div>
            <div class="menu-item" *ngIf="hasVideoQuality(Quality.Medium)" (click)="onDownload(Quality.Medium, 'combined', $event)">Medium ({{ getVideoQuality(Quality.Medium) }})</div>
            <div class="menu-item" *ngIf="hasVideoQuality(Quality.Worst)" (click)="onDownload(Quality.Worst, 'combined', $event)">Low ({{ getVideoQuality(Quality.Worst) }})</div>
          </div>
        </div>

        <!-- Audio Only Option -->
        <div class="menu-item-wrapper"
             *ngIf="hasAudioUrls()"
             (mouseenter)="showAudioMenu($event)"
             (mouseleave)="showAudioSubmenu = false">
          <div class="menu-item">
            <span>Audio</span>
            <fa-icon [icon]="faChevronRight" class="submenu-arrow"></fa-icon>
          </div>

          <!-- Audio Quality Submenu -->
          <div class="dropdown-menu submenu" *ngIf="showAudioSubmenu">
            <div class="menu-item" *ngIf="hasAudioQuality(Quality.Best)" (click)="onDownload(Quality.Best, 'audio', $event)">Best ({{ getAudioQuality(Quality.Best) }})</div>
            <div class="menu-item" *ngIf="hasAudioQuality(Quality.Medium)" (click)="onDownload(Quality.Medium, 'audio', $event)">Medium ({{ getAudioQuality(Quality.Medium) }})</div>
            <div class="menu-item" *ngIf="hasAudioQuality(Quality.Worst)" (click)="onDownload(Quality.Worst, 'audio', $event)">Low ({{ getAudioQuality(Quality.Worst) }})</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>